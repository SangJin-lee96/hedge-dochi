<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="내 자산의 황금비율을 찾아라! 포트폴리오 리밸런싱 매니저. 감정에 휘둘리지 않는 투자를 도와드립니다.">
    <title>포트폴리오 리밸런싱 | My Wealth Tier</title>
    <meta property="og:title" content="포트폴리오 리밸런싱 | My Wealth Tier">
    <meta property="og:description" content="복잡한 계산은 이제 그만. 내 자산의 현재 비율을 진단하고, 매수/매도 수량을 직관적으로 알려드립니다.">
    <meta property="og:image" content="https://hedge-dochi-live.pages.dev/og-image.png">
    <meta property="og:url" content="https://hedge-dochi-live.pages.dev/rebalance.html">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GFMXESYQFR"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GFMXESYQFR');
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --color-primary-text: #1e293b;
            --color-secondary-text: #64748b;
            --color-background: #f8fafc;
            --color-card-background: #ffffff;
            --color-card-border: #e2e8f0;
            --color-input-background: #f8fafc;
            --color-input-border: #e2e8f0;
            --color-input-text: #334155;
            --color-nav-bg: #ffffff;
            --nav-bg-rgb: 255, 255, 255;
            --color-nav-border: #f1f5f9;
            --color-nav-link: #2563eb;
            --color-nav-link-hover-bg: #eff6ff;
            --color-toggle-text: #64748b;
            --color-toggle-hover-bg: #f8fafc;
        }
        html.dark {
            --color-primary-text: #f8fafc;
            --color-secondary-text: #94a3b8;
            --color-background: #0f172a;
            --color-card-background: #1e293b;
            --color-card-border: #334155;
            --color-input-background: #334155;
            --color-input-border: #475569;
            --color-input-text: #f1f5f9;
            --color-nav-bg: #1e293b;
            --nav-bg-rgb: 30, 41, 59;
            --color-nav-border: #334155;
            --color-nav-link: #60a5fa;
            --color-nav-link-hover-bg: #0f172a;
            --color-toggle-text: #94a3b8;
            --color-toggle-hover-bg: #334155;
        }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--color-background); color: var(--color-primary-text); word-break: keep-all; }
        .transition-colors { transition-duration: 300ms; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @media (max-width: 1023px) {
            .contents-mobile { display: contents !important; }
        }

        .tooltip-box {
            visibility: hidden; opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateY(10px);
        }
        .group:hover .tooltip-box { visibility: visible; opacity: 1; transform: translateY(0); }

        @keyframes slideDown {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-down { animation: slideDown 0.3s ease forwards; }
        
        /* Mobile High-Density UI */
        @media (max-width: 767px) {
            #section-strategy { overflow: visible !important; }
            #strategyContainer {
                padding: 24px 4px 12px 4px !important;
                overflow-y: visible !important;
            }
            #assetListBody tr {
                display: block;
                padding: 0.65rem !important; /* Slightly reduced padding */
                margin-bottom: 0.375rem !important; /* Reduced from 0.5rem */
                border: 1px solid var(--color-card-border);
                border-radius: 1rem;
                background-color: var(--color-card-background);
                box-shadow: 0 2px 4px -1px rgb(0 0 0 / 0.05);
            }
            #assetListBody td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.2rem 0;
                border: none;
                width: 100% !important;
                text-align: left !important;
            }
            #assetListBody td::before {
                content: attr(data-label);
                font-weight: 700;
                font-size: 10px;
                color: var(--color-secondary-text);
                text-transform: uppercase;
            }
            /* Row based controls */
            #assetListBody td[data-label="잠금"],
            #assetListBody td[data-label="삭제"],
            #assetListBody td[data-label="보유수량"],
            #assetListBody td[data-label="현재가($)"] {
                display: none !important;
            }
            #assetListBody td[data-label="종목/섹터"]::before,
            #assetListBody td[data-label="액션"]::before {
                display: none;
            }
            #assetListBody td[data-label="종목/섹터"] {
                padding-bottom: 0.4rem;
                border-bottom: 1px solid var(--color-card-border);
                margin-bottom: 0.3rem;
                display: block;
            }
        }
    </style>
</head>
<body class="min-h-screen relative overflow-x-hidden transition-colors">
    <header class="sticky top-0 z-[100] w-full backdrop-blur-md border-b transition-colors duration-300" style="background-color: rgba(var(--nav-bg-rgb), 0.7); border-color: var(--color-nav-border);">
        <div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2 cursor-pointer" onclick="location.href='index.html'">
                <span class="text-xl">💎</span>
                <span class="font-bold text-lg tracking-tight whitespace-nowrap" style="word-break: keep-all;">Hedge Dochi</span>
            </div>
            <nav class="hidden md:flex items-center gap-1 md:gap-4">
                <a href="index.html" class="text-sm font-semibold px-3 py-2 rounded-lg transition-colors whitespace-nowrap" style="color: var(--color-nav-link); word-break: keep-all;">자산 시뮬레이터</a>
                <a href="lotto.html" class="text-sm font-semibold px-3 py-2 rounded-lg transition-colors whitespace-nowrap" style="color: var(--color-nav-link); word-break: keep-all;">로또 추천</a>
                <a href="rebalance.html" class="text-sm font-extrabold px-3 py-2 rounded-lg transition-colors bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 whitespace-nowrap" style="word-break: keep-all;">리밸런싱</a>
                <div class="w-px h-4 bg-slate-200 dark:bg-slate-700 mx-1"></div>
                <button id="darkModeToggle" class="p-2 rounded-lg transition-colors" style="color: var(--color-toggle-text);">🌙</button>
                <div id="authContainer" class="ml-2">
                    <button id="loginBtn" class="bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-2 px-4 rounded-full transition-colors">구글 로그인</button>
                    <div id="userProfile" class="hidden flex items-center gap-2">
                        <img id="userPhoto" src="" alt="Profile" class="w-8 h-8 rounded-full border border-slate-200">
                        <button id="logoutBtn" class="text-xs text-slate-500 font-semibold">로그아웃</button>
                    </div>
                </div>
            </nav>
            <div class="flex items-center gap-2 md:hidden">
                <button id="darkModeToggleMobile" class="p-2 rounded-lg transition-colors" style="color: var(--color-toggle-text);">🌙</button>
                <button id="mobileMenuBtn" class="p-2 rounded-lg" style="color: var(--color-primary-text);">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <div id="mobileMenu" class="hidden md:hidden absolute top-16 left-0 w-full border-b shadow-lg transition-all z-[110]" style="background-color: var(--color-nav-bg); border-color: var(--color-nav-border);">
            <nav class="flex flex-col p-4 space-y-2">
                <a href="index.html" class="text-base font-semibold p-4 rounded-xl whitespace-nowrap" style="color: var(--color-nav-link); word-break: keep-all;">자산 시뮬레이터</a>
                <a href="lotto.html" class="text-base font-semibold p-4 rounded-xl whitespace-nowrap" style="color: var(--color-nav-link); word-break: keep-all;">로또 추천</a>
                <a href="rebalance.html" class="text-base font-extrabold p-4 rounded-xl bg-blue-50 dark:bg-blue-900/20 text-blue-600 whitespace-nowrap" style="word-break: keep-all;">리밸런싱</a>
                <div id="authContainerMobile" class="p-4 border-t border-slate-100 dark:border-slate-700"></div>
            </nav>
        </div>
    </header>

    <main class="py-4 px-4 md:py-6 max-w-6xl mx-auto">
        <header class="mb-4 md:mb-6 text-center md:text-left">
            <h1 class="text-2xl md:text-4xl font-extrabold tracking-tight">⚖️ 포트폴리오 리밸런싱</h1>
            <p class="mt-2 text-base md:text-lg font-medium text-slate-500">현재 자산의 실제 비중(Actual)과 목표 비중(Target)을 관리하세요.</p>
        </header>

        <div id="loginAlert" class="mb-6 p-6 bg-blue-50 dark:bg-blue-900/20 rounded-2xl border border-blue-100 dark:border-blue-800 text-center">
            <p class="text-blue-800 dark:text-blue-200 font-bold text-lg mb-2">🔒 로그인이 필요한 기능입니다</p>
            <button onclick="document.getElementById('loginBtn').click()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition-all transform hover:-translate-y-1">지금 시작하기</button>
        </div>

        <div id="appContent" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
            
            <!-- LEFT COLUMN (Search, Strategy, Sector, List) -->
            <div id="col-left" class="contents-mobile lg:col-span-7 flex flex-col gap-6">
                
                <!-- 2. 종목 검색 (Order 2) -->
                <div id="section-search" class="order-2 p-5 md:p-6 rounded-2xl md:rounded-3xl shadow-xl border transition-all bg-white dark:bg-[#1e293b] border-slate-200 dark:border-slate-700">
                    <h3 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2"><span>🔍</span> 종목 검색 및 추가</h3>
                    <div class="relative">
                        <input type="text" id="tickerSearchInput" placeholder="기업명, 티커 또는 가상자산 입력" class="w-full bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl p-4 pl-12 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all font-bold text-slate-800 dark:text-white">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-xl">🔎</span>
                    </div>
                    <div id="searchResultsContainer" class="mt-4 hidden border-t border-slate-100 dark:border-slate-700 pt-4">
                        <ul id="searchResults" class="space-y-2 max-h-60 overflow-y-auto pr-2"></ul>
                    </div>
                </div>

                <!-- 3. 투자 성향 선택 (Order 3) -->
                <div id="section-strategy" class="order-3 space-y-4">
                    <h3 class="text-lg md:text-xl font-bold flex items-center gap-2 px-2 text-slate-800 dark:text-slate-100">
                        <span class="text-2xl">🦔</span> 투자 성향 선택
                    </h3>
                    <div id="strategyContainer" class="flex lg:grid lg:grid-cols-3 gap-4 overflow-x-auto lg:overflow-x-visible no-scrollbar pb-4 lg:pb-0 snap-x snap-mandatory px-2 lg:px-0">
                        <div id="card-aggressive" onclick="selectDochi('aggressive')" class="strategy-card group flex-shrink-0 w-[280px] lg:w-full snap-center cursor-pointer p-6 rounded-2xl bg-white dark:bg-[#252a3d] border border-slate-200 dark:border-rose-500/30 hover:border-rose-500 transition-all duration-500 text-center">
                            <div class="w-14 h-14 mx-auto mb-4 bg-gradient-to-tr from-rose-500 to-orange-400 rounded-2xl flex items-center justify-center text-3xl shadow-xl">🦔🔥</div>
                            <h4 class="text-xl font-black mb-1 text-rose-500">공격도치</h4>
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mb-2">High Risk</p>
                            <p class="text-xs text-slate-500 dark:text-slate-300 leading-relaxed font-medium">베타 가속 및 수익 극대화</p>
                        </div>
                        <div id="card-balanced" onclick="selectDochi('balanced')" class="strategy-card group flex-shrink-0 w-[280px] lg:w-full snap-center cursor-pointer p-6 rounded-2xl bg-white dark:bg-[#252a3d] border border-slate-200 dark:border-blue-500/30 hover:border-blue-500 transition-all duration-500 text-center">
                            <div class="w-14 h-14 mx-auto mb-4 bg-gradient-to-tr from-blue-500 to-indigo-400 rounded-2xl flex items-center justify-center text-3xl shadow-xl">🦔⚖️</div>
                            <h4 class="text-xl font-black mb-1 text-blue-500">중도도치</h4>
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mb-2">Balanced</p>
                            <p class="text-xs text-slate-500 dark:text-slate-300 leading-relaxed font-medium">위험 대비 수익의 균형</p>
                        </div>
                        <div id="card-defensive" onclick="selectDochi('defensive')" class="strategy-card group flex-shrink-0 w-[280px] lg:w-full snap-center cursor-pointer p-6 rounded-2xl bg-white dark:bg-[#252a3d] border border-slate-200 dark:border-emerald-500/30 hover:border-emerald-500 transition-all duration-500 text-center">
                            <div class="w-14 h-14 mx-auto mb-4 bg-gradient-to-tr from-emerald-500 to-teal-400 rounded-2xl flex items-center justify-center text-3xl shadow-xl">🦔🛡️</div>
                            <h4 class="text-xl font-black mb-1 text-emerald-500">수비도치</h4>
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mb-2">Preservation</p>
                            <p class="text-xs text-slate-500 dark:text-slate-300 leading-relaxed font-medium">원금 보호와 자산 방어 우선</p>
                        </div>
                    </div>
                </div>

                <!-- 5. 섹터별 비중 현황 (Order 5) -->
                <div id="section-sector" class="order-5 p-5 md:p-8 rounded-2xl md:rounded-3xl shadow-xl border transition-all bg-white dark:bg-[#1e293b] border-slate-200 dark:border-slate-700">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg md:text-xl font-bold flex items-center gap-2"><span>📊</span> 섹터별 비중 현황</h3>
                        <div id="sectorTotalStatus" class="text-xs font-bold px-3 py-1 rounded-full bg-emerald-100 text-emerald-700">Total: 100%</div>
                    </div>
                    <div id="sectorDashboard" class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-6">
                        <div class="space-y-2">
                            <div class="flex items-center justify-between gap-2">
                                <div class="flex items-center gap-1.5 min-w-0 flex-1"><span class="text-sm font-bold truncate text-slate-800 dark:text-slate-200">📈 주식</span><button onclick="distributeSector('주식 (Equity)')" class="text-[8px] bg-slate-100 dark:bg-slate-700 px-1 py-0.5 rounded font-bold hover:bg-blue-100 transition-colors">균등배분</button></div>
                                <div class="flex items-center gap-1 flex-shrink-0"><input type="number" id="target_equity" value="0" class="w-10 text-right font-bold text-blue-600 bg-transparent border-b border-blue-500 focus:outline-none" onchange="updateSectorTarget('주식 (Equity)', this.value)"><span class="text-[10px] font-bold text-slate-400">%</span></div>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden flex"><div id="progress_equity_current" class="h-full bg-blue-500 transition-all duration-500" style="width: 0%"></div><div id="progress_equity_gap" class="h-full bg-blue-300/30 transition-all duration-500" style="width: 0%"></div></div>
                            <div class="flex justify-between text-[10px] font-bold mt-1 uppercase text-slate-400"><span>Act: <span id="current_equity_pct">0%</span></span><span>Tgt: <span id="target_equity_pct_val" class="text-blue-500">0%</span></span></div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between gap-2">
                                <div class="flex items-center gap-1.5 min-w-0 flex-1"><span class="text-sm font-bold truncate text-slate-800 dark:text-slate-200">🛡️ 채권</span><button onclick="distributeSector('채권 (Fixed Income)')" class="text-[8px] bg-slate-100 dark:bg-slate-700 px-1 py-0.5 rounded font-bold hover:bg-blue-100 transition-colors">균등배분</button></div>
                                <div class="flex items-center gap-1 flex-shrink-0"><input type="number" id="target_bonds" value="0" class="w-10 text-right font-bold text-emerald-600 bg-transparent border-b border-emerald-500 focus:outline-none" onchange="updateSectorTarget('채권 (Fixed Income)', this.value)"><span class="text-[10px] font-bold text-slate-400">%</span></div>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden flex"><div id="progress_bonds_current" class="h-full bg-emerald-500 transition-all duration-500" style="width: 0%"></div><div id="progress_bonds_gap" class="h-full bg-emerald-300/30 transition-all duration-500" style="width: 0%"></div></div>
                            <div class="flex justify-between text-[10px] font-bold mt-1 uppercase text-slate-400"><span>Act: <span id="current_bonds_pct">0%</span></span><span>Tgt: <span id="target_bonds_pct_val" class="text-emerald-500">0%</span></span></div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between gap-2">
                                <div class="flex items-center gap-1.5 min-w-0 flex-1"><span class="text-sm font-bold truncate text-slate-800 dark:text-slate-200">✨ 귀금속</span><button onclick="distributeSector('귀금속 (Precious Metals)')" class="text-[8px] bg-slate-100 dark:bg-slate-700 px-1 py-0.5 rounded font-bold hover:bg-blue-100 transition-colors">균등배분</button></div>
                                <div class="flex items-center gap-1 flex-shrink-0"><input type="number" id="target_gold" value="0" class="w-10 text-right font-bold text-amber-600 bg-transparent border-b border-amber-500 focus:outline-none" onchange="updateSectorTarget('귀금속 (Precious Metals)', this.value)"><span class="text-[10px] font-bold text-slate-400">%</span></div>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden flex"><div id="progress_gold_current" class="h-full bg-amber-500 transition-all duration-500" style="width: 0%"></div><div id="progress_gold_gap" class="h-full bg-amber-300/30 transition-all duration-500" style="width: 0%"></div></div>
                            <div class="flex justify-between text-[10px] font-bold mt-1 uppercase text-slate-400"><span>Act: <span id="current_gold_pct">0%</span></span><span>Tgt: <span id="target_gold_pct_val" class="text-amber-500">0%</span></span></div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between gap-2">
                                <div class="flex items-center gap-1.5 min-w-0 flex-1"><span class="text-sm font-bold truncate text-slate-800 dark:text-slate-200">📀 원자재</span><button onclick="distributeSector('원자재 (Commodity)')" class="text-[8px] bg-slate-100 dark:bg-slate-700 px-1 py-0.5 rounded font-bold hover:bg-blue-100 transition-colors">균등배분</button></div>
                                <div class="flex items-center gap-1 flex-shrink-0"><input type="number" id="target_commodity" value="0" class="w-10 text-right font-bold text-orange-600 bg-transparent border-b border-orange-500 focus:outline-none" onchange="updateSectorTarget('원자재 (Commodity)', this.value)"><span class="text-[10px] font-bold text-slate-400">%</span></div>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden flex"><div id="progress_commodity_current" class="h-full bg-orange-500 transition-all duration-500" style="width: 0%"></div><div id="progress_commodity_gap" class="h-full bg-orange-300/30 transition-all duration-500" style="width: 0%"></div></div>
                            <div class="flex justify-between text-[10px] font-bold mt-1 uppercase text-slate-400"><span>Act: <span id="current_commodity_pct">0%</span></span><span>Tgt: <span id="target_commodity_pct_val" class="text-orange-500">0%</span></span></div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between gap-2">
                                <div class="flex items-center gap-1.5 min-w-0 flex-1"><span class="text-sm font-bold truncate text-slate-800 dark:text-slate-200">₿ 가상자산</span><button onclick="distributeSector('가상자산 (Digital Asset)')" class="text-[8px] bg-slate-100 dark:bg-slate-700 px-1 py-0.5 rounded font-bold hover:bg-blue-100 transition-colors">균등배분</button></div>
                                <div class="flex items-center gap-1 flex-shrink-0"><input type="number" id="target_crypto" value="0" class="w-10 text-right font-bold text-purple-600 bg-transparent border-b border-purple-500 focus:outline-none" onchange="updateSectorTarget('가상자산 (Digital Asset)', this.value)"><span class="text-[10px] font-bold text-slate-400">%</span></div>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden flex"><div id="progress_crypto_current" class="h-full bg-purple-500 transition-all duration-500" style="width: 0%"></div><div id="progress_crypto_gap" class="h-full bg-purple-300/30 transition-all duration-500" style="width: 0%"></div></div>
                            <div class="flex justify-between text-[10px] font-bold mt-1 uppercase text-slate-400"><span>Act: <span id="current_crypto_pct">0%</span></span><span>Tgt: <span id="target_crypto_pct_val" class="text-purple-500">0%</span></span></div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between gap-2">
                                <div class="flex items-center gap-1.5 min-w-0 flex-1"><span class="text-sm font-bold truncate text-slate-800 dark:text-slate-200">💵 현금</span><button onclick="distributeSector('현금 (Liquidity)')" class="text-[8px] bg-slate-100 dark:bg-slate-700 px-1 py-0.5 rounded font-bold hover:bg-blue-100 transition-colors">균등배분</button></div>
                                <div class="flex items-center gap-1 flex-shrink-0"><input type="number" id="target_cash" value="0" class="w-10 text-right font-bold text-slate-600 bg-transparent border-b border-slate-500 focus:outline-none" onchange="updateSectorTarget('현금 (Liquidity)', this.value)"><span class="text-[10px] font-bold text-slate-400">%</span></div>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden flex"><div id="progress_cash_current" class="h-full bg-slate-500 transition-all duration-500" style="width: 0%"></div><div id="progress_cash_gap" class="h-full bg-slate-300/30 transition-all duration-500" style="width: 0%"></div></div>
                            <div class="flex justify-between text-[10px] font-bold mt-1 uppercase text-slate-400"><span>Act: <span id="current_cash_pct">0%</span></span><span>Tgt: <span id="target_cash_pct_val" class="text-slate-500">0%</span></span></div>
                        </div>
                    </div>
                </div>

                <!-- 4. 보유 자산 목록 (Order 4) -->
                <div id="section-list" class="order-4 p-5 md:p-6 rounded-2xl md:rounded-3xl shadow-xl border transition-all bg-white dark:bg-[#1e293b] border-slate-200 dark:border-slate-700">
                    <div class="flex items-center justify-between mb-6 gap-2">
                        <h3 class="text-base md:text-lg font-bold whitespace-nowrap">📋 보유 자산 목록</h3>
                        <div class="flex items-center gap-1.5 overflow-x-auto no-scrollbar pb-1">
                             <button id="refreshPricesBtn" class="bg-slate-100 dark:bg-slate-700 px-2.5 py-1.5 rounded-lg text-[10px] font-bold border border-slate-200 dark:border-slate-600 whitespace-nowrap">🔄 시세</button>
                             <label class="cursor-pointer bg-slate-100 dark:bg-slate-700 px-2.5 py-1.5 rounded-lg text-[10px] font-bold border border-slate-200 dark:border-slate-600 whitespace-nowrap"><span>📤</span> CSV<input type="file" id="csvFileInput" class="hidden" accept=".csv"></label>
                             <button onclick="normalizeWeights()" class="bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 px-2.5 py-1.5 rounded-lg text-[10px] font-bold border border-indigo-100 dark:border-indigo-800 whitespace-nowrap">⚖️ 비중 맞춤</button>
                             <button id="addAssetBtn" class="bg-indigo-600 text-white px-2.5 py-1.5 rounded-lg text-[10px] font-bold shadow-sm whitespace-nowrap">+ 종목</button>
                             <button id="saveBtn" class="bg-emerald-600 text-white px-2.5 py-1.5 rounded-lg text-[10px] font-bold shadow-sm whitespace-nowrap">💾 저장</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto pb-4 -mx-5 px-5 sm:mx-0 sm:px-0"> 
                        <table class="w-full text-left border-collapse table-auto min-w-[650px]">
                            <thead>
                                <tr class="text-[10px] font-bold border-b uppercase tracking-wider text-slate-400 md:table-row hidden" style="border-color: var(--color-hr-border);">
                                    <th class="py-3 px-2 w-14 text-center relative group whitespace-nowrap">
                                        <div class="flex items-center justify-center gap-1 cursor-help">
                                            <span>잠금</span>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-400 group-hover:text-blue-500 transition-colors"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                                        </div>
                                        <div class="tooltip-box absolute top-full left-0 mt-2 w-64 p-3 bg-[#1a1f2e] text-white text-xs rounded-xl shadow-2xl z-[999] whitespace-normal text-left font-normal border border-slate-700/50 backdrop-blur-md !transform-none">
                                            <div class="absolute bottom-full left-4 border-4 border-transparent border-b-[#1a1f2e]"></div>
                                            잠금 기능을 활성화하면 리밸런싱 계산 시 해당 종목의 비중을 고정하고 나머지 종목들로만 비중을 재분배합니다.
                                        </div>
                                    </th>
                                    <th class="py-3 px-2 text-left min-w-[160px]">종목/섹터</th>
                                    <th class="py-3 px-2 text-right w-24">보유수량</th>
                                    <th class="py-3 px-2 text-right w-24">현재가($)</th>
                                    <th class="py-3 px-2 text-right w-24 text-indigo-500">Actual%</th>
                                    <th class="py-3 px-2 text-right w-24 text-blue-500">Target%</th>
                                    <th class="py-3 px-2 text-center w-10">✕</th>
                                </tr>
                            </thead>
                            <tbody id="assetListBody" class="text-xs md:text-sm font-medium"></tbody>
                        </table>
                    </div>
                    <div class="mt-4 pt-4 border-t border-slate-100 dark:border-slate-800 text-right">
                        <p id="totalPercentDisplay" class="font-bold text-base text-indigo-600">목표 비중 합계: 0%</p>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN (Summary, Guide, Charts, Simulation) -->
            <div id="col-right" class="contents-mobile lg:col-span-5 flex flex-col gap-6">
                
                <!-- 1. 요약 대시보드 (Order 1) -->
                <div id="section-summary" class="order-1 p-6 md:p-8 rounded-2xl md:rounded-3xl shadow-xl bg-gradient-to-br from-indigo-500 to-purple-600 text-white">
                    <div class="flex justify-between items-start mb-6">
                        <div><p class="text-xs font-bold uppercase mb-1 opacity-80">현재 총 자산</p><h2 id="totalValueDisplay" class="text-2xl md:text-3xl font-black">$0.00</h2></div>
                        <div class="text-right"><p class="text-xs font-bold uppercase mb-1 opacity-80">목표 투자 금액</p><div class="relative inline-block"><span class="absolute left-2 top-1/2 -translate-y-1/2 text-indigo-300 font-bold">$</span><input type="number" id="targetCapitalInput" class="bg-white/10 border border-white/20 rounded-lg py-1 px-3 pl-6 text-xl font-black text-white w-28 md:w-32 focus:outline-none" placeholder="0"></div></div>
                    </div>
                    <div id="rebalanceStatus" class="p-4 bg-white/10 rounded-xl backdrop-blur-md border border-white/20 flex items-center gap-3">
                        <span id="statusIcon" class="text-xl md:text-2xl">✅</span>
                        <div><h4 id="statusTitle" class="font-bold text-sm md:text-base">계산기 준비 완료</h4><p id="statusDesc" class="text-xs md:text-sm opacity-90">목표 금액과 비중을 설정하세요.</p></div>
                    </div>
                </div>

                <!-- 6. 리밸런싱 가이드 (Order 6) -->
                <div id="section-guide" class="order-6 p-5 md:p-6 rounded-2xl md:rounded-3xl shadow-xl border transition-all bg-white dark:bg-[#1e293b] border-slate-200 dark:border-slate-700">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg md:text-xl font-bold">🚀 리밸런싱 가이드</h3>
                        <div class="flex items-center gap-2">
                            <label class="text-xs font-semibold cursor-pointer">정수 단위 매매</label>
                            <input type="checkbox" id="integerModeToggle" class="w-4 h-4">
                        </div>
                    </div>
                    <!-- Total Friction Cost Pinned Above -->
                    <div id="totalFrictionCostDisplay" class="mb-4 p-3 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-700 hidden">
                        <div class="flex justify-between items-center">
                            <span class="text-xs font-bold text-slate-500">총 예상 거래 비용(수수료+세금)</span>
                            <span id="frictionCostValue" class="text-sm font-black text-rose-500 font-mono">$0.00</span>
                        </div>
                        <div id="frictionCostWarning" class="mt-2 text-[10px] font-bold text-amber-600 dark:text-amber-400 flex items-start gap-1.5 hidden">
                            <span class="text-base leading-none">🦔🛡️</span>
                            <p class="word-break: keep-all;">거래 비용이 높습니다. 리밸런싱 주기를 조절하거나 비중 변화가 큰 종목 위주로 실행하세요.</p>
                        </div>
                    </div>
                    <div id="actionPlanList" class="space-y-3"><p class="text-sm text-slate-500 py-4 text-center">데이터를 입력하면 가이드가 생성됩니다.</p></div>
                </div>

                <!-- 7. 차트 영역 (Order 7) -->
                <div id="section-charts" class="order-7 p-5 md:p-6 rounded-2xl md:rounded-3xl shadow-xl border transition-all bg-white dark:bg-[#1e293b] border-slate-200 dark:border-slate-700 text-center">
                    <h3 class="text-xs font-bold uppercase text-slate-400 mb-4">자산군 및 종목 비중</h3>
                    <div class="relative h-56 md:h-64 mb-8"><canvas id="portfolioChart"></canvas></div>
                    <hr class="border-slate-100 dark:border-slate-800 my-6">
                    <div class="relative h-56 md:h-64"><canvas id="tickerChart"></canvas></div>
                </div>

                <!-- 8. 시뮬레이션 차트 (Order 8) -->
                <div id="section-simulation" class="order-8 p-5 md:p-6 rounded-2xl md:rounded-3xl shadow-xl border transition-all bg-white dark:bg-[#1e293b] border-slate-200 dark:border-slate-700">
                    <h3 class="text-xs font-bold uppercase text-center mb-4 text-slate-400">📈 10년 자산 성장 예측</h3>
                    <div class="relative h-56 md:h-64"><canvas id="simulationChart"></canvas></div>
                </div>
            </div>

            <!-- 9. 스마트한 리밸런싱 가이드 (Order 9) -->
            <div id="section-bottom-info" class="lg:col-span-12 order-9 mt-4">
                <div class="p-6 md:p-12 rounded-2xl md:rounded-3xl shadow-xl border bg-slate-50 dark:bg-slate-800/50 transition-all border-slate-200 dark:border-slate-700">
                    <h3 class="text-xl md:text-2xl font-bold mb-6 md:mb-8 flex items-center gap-3"><span class="bg-blue-600 text-white p-2 rounded-xl shadow-lg">🎓</span> 스마트한 리밸런싱 핵심 가이드</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8 text-sm leading-relaxed">
                        <div class="space-y-4">
                            <div class="text-blue-600 dark:text-blue-400 font-black text-lg">01</div>
                            <h4 class="font-bold text-slate-800 dark:text-white text-base">리밸런싱의 정의</h4>
                            <p class="text-slate-600 dark:text-slate-300 text-xs md:text-sm">시간이 지남에 따라 각 자산의 가격 변동으로 인해 초기 설정한 비중이 깨지게 됩니다. 리밸런싱은 비중이 늘어난 자산을 팔고, 줄어든 자산을 사서 목표 비율을 복구하는 과학적 과정입니다.</p>
                        </div>
                        <div class="space-y-4">
                            <div class="text-blue-600 dark:text-blue-400 font-black text-lg">02</div>
                            <h4 class="font-bold text-slate-800 dark:text-white text-base">왜 수익이 개선되나요?</h4>
                            <p class="text-slate-600 dark:text-slate-300 text-xs md:text-sm">리밸런싱은 자연스럽게 '고점 매도, 저점 매수'를 강제합니다. 승리한 자산의 이익을 실현하고 저평가된 자산을 채워 넣음으로써 장기적인 복리 효과와 위험 대비 수익률을 극대화합니다.</p>
                        </div>
                        <div class="space-y-4">
                            <div class="text-blue-600 dark:text-blue-400 font-black text-lg">03</div>
                            <h4 class="font-bold text-slate-800 dark:text-white text-base">권장 시행 주기</h4>
                            <p class="text-slate-600 dark:text-slate-300 text-xs md:text-sm">너무 잦은 매매는 수수료와 세금 부담을 줄 수 있습니다. 일반적으로 6개월~1년 단위로 정기 시행하거나, 특정 자산의 비중이 목표치에서 5% 이상 벗어났을 때 시행하는 것이 효율적입니다.</p>
                        </div>
                        <div class="space-y-4">
                            <div class="text-blue-600 dark:text-blue-400 font-black text-lg">04</div>
                            <h4 class="font-bold text-slate-800 dark:text-white text-base">전략적 자산 배분</h4>
                            <p class="text-slate-600 dark:text-slate-300 text-xs md:text-sm">공격, 중도, 수비도치 전략은 자산 간의 상관관계를 분석하여 설계되었습니다. 본인의 투자 성향에 맞춘 최적의 비중을 설정하고, 시장의 파도 속에서도 중심을 잃지 않는 투자를 지속하세요.</p>
                        </div>
                    </div>
                </div>

                <!-- FAQ 섹션 추가 -->
                <section class="mt-12 pt-12 border-t border-slate-100 dark:border-slate-800">
                    <h2 class="text-2xl md:text-3xl font-extrabold mb-8 text-center">리밸런싱 매니저 FAQ</h2>
                    <div class="max-w-4xl mx-auto space-y-8">
                        <div class="bg-white dark:bg-[#1e293b] p-6 md:p-8 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-lg">
                            <h3 class="text-lg md:text-xl font-bold mb-4 text-blue-600 dark:text-blue-400">Q. 포트폴리오 리밸런싱이 왜 중요한가요?</h3>
                            <p class="text-slate-600 dark:text-slate-300 leading-relaxed text-sm md:text-base">
                                리밸런싱은 투자자의 감정을 배제하고 통계적 원칙에 따라 자산을 관리하게 해주는 가장 강력한 도구입니다. 시장이 과열되어 특정 자산의 가격이 폭등하면 해당 자산의 비중이 비정상적으로 커지게 되는데, 이때 리밸런싱을 통해 일부 이익을 실현하고 소외되어 가격이 저렴해진 다른 자산을 매수함으로써 자산의 균형을 맞춥니다. 이는 하락장에서의 변동성을 방어할 뿐만 아니라, 장기적으로는 단순히 보유(Buy and Hold)하는 것보다 더 높은 위험 대비 수익률(샤프 지수)을 제공합니다. 특히 Hedge Dochi의 리밸런싱 매니저는 실시간 시세를 반영하여 사용자가 직관적으로 매매 수량을 파악할 수 있도록 돕습니다.
                            </p>
                        </div>
                        <div class="bg-white dark:bg-[#1e293b] p-6 md:p-8 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-lg">
                            <h3 class="text-lg md:text-xl font-bold mb-4 text-emerald-600 dark:text-emerald-400">Q. 최적의 리밸런싱 주기와 방법은 무엇인가요?</h3>
                            <p class="text-slate-600 dark:text-slate-300 leading-relaxed text-sm md:text-base">
                                리밸런싱 주기에 정답은 없으나, 학술적 연구와 실무적 경험에 따르면 '시간 기반'과 '임계치 기반'을 병행하는 것이 가장 효율적입니다. 매월 또는 매 분기 특정 날짜에 기계적으로 비중을 맞추는 방법이 있으며, 혹은 특정 자산군이 목표 비중에서 일정 비율(예: 5%p 또는 전체 비중의 20% 상대 오차) 이상 벗어났을 때 즉시 실행하는 방법이 있습니다. Hedge Dochi는 사용자가 설정한 목표 비중과 현재 비중의 차이를 실시간으로 계산하여 경고를 주고, 거래 비용(수수료 및 세금)을 고려한 최적의 매매 가이드를 생성합니다. 무분별한 잦은 거래보다는 자산 성장의 흐름을 깨지 않는 범위 내에서 정기적인 점검을 권장합니다.
                            </p>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Glossary Section -->
        <section id="glossary" class="mt-12 pt-12 border-t border-slate-100 dark:border-slate-800">
            <div class="max-w-4xl mx-auto px-4">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-2"><span>📖</span> 투자 용어 사전 (Glossary)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-4 bg-slate-50 dark:bg-slate-800/30 rounded-xl border border-slate-100 dark:border-slate-700/50">
                        <h3 class="font-bold text-blue-600 dark:text-blue-400 text-sm mb-1">MPT (현대 포트폴리오 이론)</h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400 leading-relaxed">자산 간의 상관관계를 분석하여 동일한 기대 수익률에서 위험(변동성)을 최소화하거나, 동일한 위험 수준에서 수익을 극대화하는 자산 배분 방식입니다.</p>
                    </div>
                    <div class="p-4 bg-slate-50 dark:bg-slate-800/30 rounded-xl border border-slate-100 dark:border-slate-700/50">
                        <h3 class="font-bold text-blue-600 dark:text-blue-400 text-sm mb-1">Sharpe Ratio (샤프 지수)</h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400 leading-relaxed">위험 한 단위당 얼마나 많은 수익을 올렸는지를 나타내는 지표입니다. 수치가 높을수록 위험 대비 수익률이 우수함을 의미합니다.</p>
                    </div>
                    <div class="p-4 bg-slate-50 dark:bg-slate-800/30 rounded-xl border border-slate-100 dark:border-slate-700/50">
                        <h3 class="font-bold text-blue-600 dark:text-blue-400 text-sm mb-1">Rebalancing (리밸런싱)</h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400 leading-relaxed">가격 변동으로 인해 비중이 변한 포트폴리오를 초기 설정한 목표 비중으로 되돌리는 과정입니다. 기계적인 고점 매도와 저점 매수를 유도합니다.</p>
                    </div>
                    <div class="p-4 bg-slate-50 dark:bg-slate-800/30 rounded-xl border border-slate-100 dark:border-slate-700/50">
                        <h3 class="font-bold text-blue-600 dark:text-blue-400 text-sm mb-1">Volatility (변동성)</h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400 leading-relaxed">자산 가격이 시간에 따라 얼마나 크게 오르내리는지를 나타냅니다. 금융에서는 보통 표준편차로 계산하며, 위험의 척도로 사용됩니다.</p>
                    </div>
                    <div class="p-4 bg-slate-50 dark:bg-slate-800/30 rounded-xl border border-slate-100 dark:border-slate-700/50 md:col-span-2">
                        <h3 class="font-bold text-blue-600 dark:text-blue-400 text-sm mb-1">Asset Allocation (자산 배분)</h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400 leading-relaxed">주식, 채권, 현금, 대체 자산 등 성격이 다른 여러 자산군에 투자 자금을 나누어 배분하는 전략으로, 전체 포트폴리오 수익과 위험의 90% 이상을 결정합니다.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center mt-12 py-8 border-t border-slate-100 dark:border-slate-800">
        <div class="max-w-6xl mx-auto text-sm text-slate-400">
            <div class="flex justify-center space-x-6 font-bold mb-4">
                <a href="about.html" class="hover:text-blue-600">소개</a>
                <a href="privacy.html" class="hover:text-blue-600">약관</a>
                <a href="contact-form.html" class="hover:text-blue-600">문의</a>
            </div>
            <p>© 2026 Hedge Dochi. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <script type="module" src="rebalance.js"></script>
    <script src="dark-mode.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('mobileMenuBtn');
            const menu = document.getElementById('mobileMenu');
            if (btn && menu) btn.addEventListener('click', () => { menu.classList.toggle('hidden'); });
        });
    </script>
</body>
</html>